/** @jsx React.DOM */
var TodoTabs = (function() {
  var baseURL = "https://bugzilla.mozilla.org";
  var bugURL = baseURL + "/show_bug.cgi?id=";
  var attachURL = baseURL + "/attachment.cgi?id=";
  var reviewURL = baseURL + "/page.cgi?id=splinter.html&bug=" // +"&attachment=" + attachId;

  var TodoTabs = React.createClass({displayName: "TodoTabs",
    render: function() {
      return (
        React.createElement("div", {id: "todo-lists", className: "tabs"}, 
          React.createElement(TabsNav, {tabs: this.props.tabs, 
              selectedTab: this.props.selectedTab, 
              data: this.props.data, 
              onTabClick: this.handleTabClick}), 
          React.createElement(TabsContent, {tabs: this.props.tabs, 
              selectedTab: this.props.selectedTab, 
              data: this.props.data, 
              includeBlockedBugs: this.props.includeBlockedBugs})
        )
      );
    },
    handleTabClick: function(tabId) {
      this.props.onTabSelect(tabId);
    }
  });

  var TabsNav = React.createClass({displayName: "TabsNav",
    render: function() {
      var selectedTab = this.props.selectedTab;

      var tabNodes = this.props.tabs.map(function(item, index) {
        var list = this.props.data[item.id];

        // display a count of the items and unseen items in this list
        var count = list.items ? list.items.length : "";
        var newCount = "";
        if (list.newCount) {
          newCount = (
            React.createElement("span", {className: "new-count"}, 
              " +", list.newCount
            )
          );
        }

        var className = "tab" + (selectedTab == item.id ? " tab-selected" : "");

        return (
          React.createElement("li", null, 
            React.createElement("a", {className: className, title: item.alt, 
               onClick: this.onClick.bind(this, item.id)}, 
              item.name, 
              React.createElement("span", {className: "count"}, 
                count
              ), 
              newCount
            )
          )
        );
      }.bind(this));

      return (
        React.createElement("nav", {className: "tab-head"}, 
          React.createElement("ul", null, 
            tabNodes
          )
        )
      );
    },
    onClick: function(index) {
      this.props.onTabClick(index);
    }
  });

  var TabsContent = React.createClass({displayName: "TabsContent",
    render: function() {
      var panelNodes = this.props.tabs.map(function(tab, index) {
        var data = this.props.data[tab.id];

        var list;
        switch(tab.type) {
          case "patches":
            list = React.createElement(PatchList, {data: data});
            break;
          case "flags":
            list = React.createElement(RespondList, {data: data});
            break;
          case "flags+reviews":
            list = React.createElement(NagList, {data: data});
            break;
          case "bugs":
          default:
            list = React.createElement(BugList, {data: data, 
                      includeBlockedBugs: this.props.includeBlockedBugs});
            break;
        }

        return (
          React.createElement("div", {className: 'tab-content ' + (this.props.selectedTab == tab.id ?
                          'tab-content-selected' : '')}, 
            list
          )
        );
      }.bind(this));

      return (
        React.createElement("div", {className: "tab-body"}, 
          panelNodes
        )
      );
    }
  });

  var BugList = React.createClass({displayName: "BugList",
    render: function() {
      var items = this.props.data.items;
      if (items) {
        // filter out the blocked bugs, if pref is set
        if (!this.props.includeBlockedBugs) {
          items = items.filter(function(item) {
            return !item.bug.depends_on || !item.bug.depends_on.length;
          });
        }
        var listItems = items.map(function(item) {
          return (
            React.createElement(ListItem, {isNew: item.new}, 
              React.createElement(BugItem, {bug: item.bug})
            )
          );
        });
      }
      return (
        React.createElement(List, {items: items}, 
          listItems
        )
      );
    }
  });

  var NagList = React.createClass({displayName: "NagList",
    render: function() {
      var items = this.props.data.items;
      if (items) {
        var listItems = items.map(function(item) {
          var flags = item.flags.map(function(flag) {
            return React.createElement(FlagItem, {flag: flag});
          });
          var patches = item.attachments.map(function(patch) {
            var patchFlags = patch.flags.map(function(flag) {
              return React.createElement(FlagItem, {flag: flag});
            });
            return (
              React.createElement("div", null, 
                React.createElement(PatchItem, {patch: patch}), 
                patchFlags
              )
            );
          });
          var requests = patches.concat(flags);

          return (
            React.createElement(ListItem, {isNew: item.new}, 
              React.createElement(BugItem, {bug: item.bug}), 
              React.createElement("div", null, 
                requests
              )
            )
          );
        });
      }
      return (
        React.createElement(List, {items: items}, 
          listItems
        )
      );
    }
  });

  var RespondList = React.createClass({displayName: "RespondList",
    render: function() {
      var items = this.props.data.items;
      if (items) {
        var listItems = items.map(function(item) {
          var flags = item.bug.flags.map(function(flag) {
            return React.createElement(FlagItem, {flag: flag});
          });
          return (
            React.createElement(ListItem, {isNew: item.new}, 
              React.createElement(BugItem, {bug: item.bug}), 
              React.createElement("div", null, 
                flags
              )
            )
          );
        });
      }
      return (
        React.createElement(List, {items: items}, 
          listItems
        )
      );
    }
  });

  var PatchList = React.createClass({displayName: "PatchList",
    render: function() {
      var items = this.props.data.items;
      if (items) {
        var listItems = items.map(function(item) {
          var patches = item.attachments.map(function(patch) {
             return React.createElement(PatchItem, {patch: patch});
          });
          return (
            React.createElement(ListItem, {isNew: item.new}, 
              React.createElement(BugItem, {bug: item.bug}), 
              React.createElement("div", null, 
                patches
              )
            )
          );
        });
      }
      return (
        React.createElement(List, {items: items}, 
          listItems
        )
      );
    }
  });

  var List = React.createClass({displayName: "List",
    render: function() {
      if (!this.props.items) {
        return React.createElement(WaitingList, null);
      }
      if (this.props.items.length == 0) {
        return React.createElement(EmptyList, null);
      }
      return (
        React.createElement("div", null, 
          this.props.children
        )
      );
    }
  })

  var WaitingList = React.createClass({displayName: "WaitingList",
    render: function() {
      return (
        React.createElement("div", {className: "list-item"}, 
          React.createElement("img", {src: "lib/indicator.gif", className: "spinner"})
        )
      );
    }
  })

  var EmptyList = React.createClass({displayName: "EmptyList",
    render: function() {
      return (
        React.createElement("div", {className: "list-item empty-message"}, 
          "No items to display"
        )
      );
    }
  })

  var PatchItem = React.createClass({displayName: "PatchItem",
    render: function() {
      var patch = this.props.patch;
      var size = Math.round(patch.size / 1000) + "KB";
      return (
        React.createElement("div", null, 
          React.createElement("a", {className: "att-link", href: attachURL + patch.id, target: "_blank", 
             title: patch.description + " - " + size}, 
             "patch by ", patch.attacher.name
          ), 
          React.createElement("span", {className: "att-suffix"}, 
            React.createElement("span", {className: "att-date timeago", title: patch.last_change_time}, 
              patch.last_change_time
            )
          )
        )
      );
    }
  });

  var FlagItem = React.createClass({displayName: "FlagItem",
    render: function() {
      var flag = this.props.flag;
      return (
        React.createElement("div", {className: "flag"}, 
          React.createElement("span", {className: "flag-name"}, 
            flag.name
          ), 
          React.createElement("span", {className: "flag-status"}, 
            flag.status, "  "
          ), 
          React.createElement("span", {className: "flag-requestee"}, 
            flag.requestee
          )
        )
      );
    }
  });

  var BugItem = React.createClass({displayName: "BugItem",
    render: function() {
      var bug = this.props.bug;
      return (
        React.createElement("div", {className: "bug"}, 
          React.createElement("a", {className: "bug-link", href: bugURL + bug.id, 
             target: "_blank", title: bug.status + " - " + bug.summary}, 
            React.createElement("span", {className: "bug-id"}, 
              bug.id
            ), 
            "- ", 
            React.createElement("span", {className: "full-bug bug-summary"}, 
              bug.summary
            )
          ), 
          React.createElement("span", {className: "item-date timeago", 
                title: bug.last_change_time}, 
            bug.last_change_time
          )
        )
      );
    }
  });

  var ListItem = React.createClass({displayName: "ListItem",
    render: function() {
      return (
        React.createElement("div", {className: "list-item " + (this.props.isNew ? "new-item" : "")}, 
          this.props.children
        )
      );
    }
  });

  return TodoTabs;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZWQuanMiLCJzb3VyY2VzIjpbbnVsbF0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHFCQUFxQjtBQUNyQixJQUFJLFFBQVEsR0FBRyxDQUFDLFdBQVc7RUFDekIsSUFBSSxPQUFPLEdBQUcsOEJBQThCLENBQUM7RUFDN0MsSUFBSSxNQUFNLEdBQUcsT0FBTyxHQUFHLG1CQUFtQixDQUFDO0VBQzNDLElBQUksU0FBUyxHQUFHLE9BQU8sR0FBRyxxQkFBcUIsQ0FBQztBQUNsRCxFQUFFLElBQUksU0FBUyxHQUFHLE9BQU8sR0FBRyxpQ0FBaUM7O0VBRTNELElBQUksOEJBQThCLHdCQUFBO0lBQ2hDLE1BQU0sRUFBRSxXQUFXO01BQ2pCO1FBQ0Usb0JBQUEsS0FBSSxFQUFBLENBQUEsQ0FBQyxFQUFBLEVBQUUsQ0FBQyxZQUFBLEVBQVksQ0FBQyxTQUFBLEVBQVMsQ0FBQyxNQUFPLENBQUEsRUFBQTtVQUNwQyxvQkFBQyxPQUFPLEVBQUEsQ0FBQSxDQUFDLElBQUEsRUFBSSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFDO2NBQzNCLFdBQUEsRUFBVyxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFDO2NBQ3BDLElBQUEsRUFBSSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFDO2NBQ3RCLFVBQUEsRUFBVSxDQUFFLElBQUksQ0FBQyxjQUFlLENBQUUsQ0FBQSxFQUFBO1VBQ3RDLG9CQUFDLFdBQVcsRUFBQSxDQUFBLENBQUMsSUFBQSxFQUFJLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUM7Y0FDL0IsV0FBQSxFQUFXLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUM7Y0FDcEMsSUFBQSxFQUFJLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUM7Y0FDdEIsa0JBQUEsRUFBa0IsQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFtQixDQUFFLENBQUE7UUFDcEQs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UyxDQUFBLEVBQUE7WUFDMUQsb0JBQUEsTUFBSyxFQUFBLENBQUEsQ0FBQyxTQUFBLEVBQVMsQ0FBQyxRQUFTLENBQUEsRUFBQTtjQUN0QixHQUFHLENBQUMsRUFBRztZQUNILENBQUEsRUFBQTtBQUFBLFlBQUEsSUFBQSxFQUFBO0FBQUEsWUFFUCxvQkFBQSxNQUFLLEVBQUEsQ0FBQSxDQUFDLFNBQUEsRUFBUyxDQUFDLHNCQUF1QixDQUFBLEVBQUE7Y0FDcEMsR0FBRyxDQUFDLE9BQVE7WUFDUixDQUFBO1VBQ0wsQ0FBQSxFQUFBO1VBQ0osb0JBQUEsTUFBSyxFQUFBLENBQUEsQ0FBQyxTQUFBLEVBQVMsQ0FBQyxtQkFBQSxFQUFtQjtnQkFDN0IsS0FBQSxFQUFLLENBQUUsR0FBRyxDQUFDLGdCQUFrQixDQUFBLEVBQUE7WUFDaEMsR0FBRyxDQUFDLGdCQUFpQjtVQUNqQixDQUFBO1FBQ0gsQ0FBQTtRQUNOO0tBQ0g7QUFDTCxHQUFHLENBQUMsQ0FBQzs7RUFFSCxJQUFJLDhCQUE4Qix3QkFBQTtJQUNoQyxNQUFNLEVBQUUsV0FBVztNQUNqQjtRQUNFLG9CQUFBLEtBQUksRUFBQSxDQUFBLENBQUMsU0FBQSxFQUFTLENBQUUsWUFBWSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLFVBQVUsR0FBRyxFQUFFLENBQUcsQ0FBQSxFQUFBO1VBQ2xFLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUztRQUNqQixDQUFBO1FBQ047S0FDSDtBQUNMLEdBQUcsQ0FBQyxDQUFDOztFQUVILE9BQU8sUUFBUSxDQUFDO0NBQ2pCLEdBQUcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xudmFyIFRvZG9UYWJzID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgYmFzZVVSTCA9IFwiaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZ1wiO1xuICB2YXIgYnVnVVJMID0gYmFzZVVSTCArIFwiL3Nob3dfYnVnLmNnaT9pZD1cIjtcbiAgdmFyIGF0dGFjaFVSTCA9IGJhc2VVUkwgKyBcIi9hdHRhY2htZW50LmNnaT9pZD1cIjtcbiAgdmFyIHJldmlld1VSTCA9IGJhc2VVUkwgKyBcIi9wYWdlLmNnaT9pZD1zcGxpbnRlci5odG1sJmJ1Zz1cIiAvLyArXCImYXR0YWNobWVudD1cIiArIGF0dGFjaElkO1xuXG4gIHZhciBUb2RvVGFicyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBpZD1cInRvZG8tbGlzdHNcIiBjbGFzc05hbWU9XCJ0YWJzXCI+XG4gICAgICAgICAgPFRhYnNOYXYgdGFicz17dGhpcy5wcm9wcy50YWJzfVxuICAgICAgICAgICAgICBzZWxlY3RlZFRhYj17dGhpcy5wcm9wcy5zZWxlY3RlZFRhYn1cbiAgICAgICAgICAgICAgZGF0YT17dGhpcy5wcm9wcy5kYXRhfVxuICAgICAgICAgICAgICBvblRhYkNsaWNrPXt0aGlzLmhhbmRsZVRhYkNsaWNrfS8+XG4gICAgICAgICAgPFRhYnNDb250ZW50IHRhYnM9e3RoaXMucHJvcHMudGFic31cbiAgICAgICAgICAgICAgc2VsZWN0ZWRUYWI9e3RoaXMucHJvcHMuc2VsZWN0ZWRUYWJ9XG4gICAgICAgICAgICAgIGRhdGE9e3RoaXMucHJvcHMuZGF0YX1cbiAgICAgICAgICAgICAgaW5jbHVkZUJsb2NrZWRCdWdzPXt0aGlzLnByb3BzLmluY2x1ZGVCbG9ja2VkQnVnc30vPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfSxcbiAgICBoYW5kbGVUYWJDbGljazogZnVuY3Rpb24odGFiSWQpIHtcbiAgICAgIHRoaXMucHJvcHMub25UYWJTZWxlY3QodGFiSWQpO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIFRhYnNOYXYgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxlY3RlZFRhYiA9IHRoaXMucHJvcHMuc2VsZWN0ZWRUYWI7XG5cbiAgICAgIHZhciB0YWJOb2RlcyA9IHRoaXMucHJvcHMudGFicy5tYXAoZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcbiAgICAgICAgdmFyIGxpc3QgPSB0aGlzLnByb3BzLmRhdGFbaXRlbS5pZF07XG5cbiAgICAgICAgLy8gZGlzcGxheSBhIGNvdW50IG9mIHRoZSBpdGVtcyBhbmQgdW5zZWVuIGl0ZW1zIGluIHRoaXMgbGlzdFxuICAgICAgICB2YXIgY291bnQgPSBsaXN0Lml0ZW1zID8gbGlzdC5pdGVtcy5sZW5ndGggOiBcIlwiO1xuICAgICAgICB2YXIgbmV3Q291bnQgPSBcIlwiO1xuICAgICAgICBpZiAobGlzdC5uZXdDb3VudCkge1xuICAgICAgICAgIG5ld0NvdW50ID0gKFxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibmV3LWNvdW50XCI+XG4gICAgICAgICAgICAgICZuYnNwOyt7bGlzdC5uZXdDb3VudH1cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwidGFiXCIgKyAoc2VsZWN0ZWRUYWIgPT0gaXRlbS5pZCA/IFwiIHRhYi1zZWxlY3RlZFwiIDogXCJcIik7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8bGk+XG4gICAgICAgICAgICA8YSBjbGFzc05hbWU9e2NsYXNzTmFtZX0gdGl0bGU9e2l0ZW0uYWx0fVxuICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkNsaWNrLmJpbmQodGhpcywgaXRlbS5pZCl9PlxuICAgICAgICAgICAgICB7aXRlbS5uYW1lfVxuICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJjb3VudFwiPlxuICAgICAgICAgICAgICAgIHtjb3VudH1cbiAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICB7bmV3Q291bnR9XG4gICAgICAgICAgICA8L2E+XG4gICAgICAgICAgPC9saT5cbiAgICAgICAgKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxuYXYgY2xhc3NOYW1lPVwidGFiLWhlYWRcIj5cbiAgICAgICAgICA8dWw+XG4gICAgICAgICAgICB7dGFiTm9kZXN9XG4gICAgICAgICAgPC91bD5cbiAgICAgICAgPC9uYXY+XG4gICAgICApO1xuICAgIH0sXG4gICAgb25DbGljazogZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgIHRoaXMucHJvcHMub25UYWJDbGljayhpbmRleCk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgVGFic0NvbnRlbnQgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwYW5lbE5vZGVzID0gdGhpcy5wcm9wcy50YWJzLm1hcChmdW5jdGlvbih0YWIsIGluZGV4KSB7XG4gICAgICAgIHZhciBkYXRhID0gdGhpcy5wcm9wcy5kYXRhW3RhYi5pZF07XG5cbiAgICAgICAgdmFyIGxpc3Q7XG4gICAgICAgIHN3aXRjaCh0YWIudHlwZSkge1xuICAgICAgICAgIGNhc2UgXCJwYXRjaGVzXCI6XG4gICAgICAgICAgICBsaXN0ID0gPFBhdGNoTGlzdCBkYXRhPXtkYXRhfS8+O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImZsYWdzXCI6XG4gICAgICAgICAgICBsaXN0ID0gPFJlc3BvbmRMaXN0IGRhdGE9e2RhdGF9Lz47XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiZmxhZ3MrcmV2aWV3c1wiOlxuICAgICAgICAgICAgbGlzdCA9IDxOYWdMaXN0IGRhdGE9e2RhdGF9Lz47XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYnVnc1wiOlxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBsaXN0ID0gPEJ1Z0xpc3QgZGF0YT17ZGF0YX1cbiAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlQmxvY2tlZEJ1Z3M9e3RoaXMucHJvcHMuaW5jbHVkZUJsb2NrZWRCdWdzfS8+O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXsndGFiLWNvbnRlbnQgJyArICh0aGlzLnByb3BzLnNlbGVjdGVkVGFiID09IHRhYi5pZCA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICd0YWItY29udGVudC1zZWxlY3RlZCcgOiAnJyl9PlxuICAgICAgICAgICAge2xpc3R9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRhYi1ib2R5XCI+XG4gICAgICAgICAge3BhbmVsTm9kZXN9XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBCdWdMaXN0ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaXRlbXMgPSB0aGlzLnByb3BzLmRhdGEuaXRlbXM7XG4gICAgICBpZiAoaXRlbXMpIHtcbiAgICAgICAgLy8gZmlsdGVyIG91dCB0aGUgYmxvY2tlZCBidWdzLCBpZiBwcmVmIGlzIHNldFxuICAgICAgICBpZiAoIXRoaXMucHJvcHMuaW5jbHVkZUJsb2NrZWRCdWdzKSB7XG4gICAgICAgICAgaXRlbXMgPSBpdGVtcy5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuICFpdGVtLmJ1Zy5kZXBlbmRzX29uIHx8ICFpdGVtLmJ1Zy5kZXBlbmRzX29uLmxlbmd0aDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGlzdEl0ZW1zID0gaXRlbXMubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPExpc3RJdGVtIGlzTmV3PXtpdGVtLm5ld30+XG4gICAgICAgICAgICAgIDxCdWdJdGVtIGJ1Zz17aXRlbS5idWd9Lz5cbiAgICAgICAgICAgIDwvTGlzdEl0ZW0+XG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8TGlzdCBpdGVtcz17aXRlbXN9PlxuICAgICAgICAgIHtsaXN0SXRlbXN9XG4gICAgICAgIDwvTGlzdD5cbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgTmFnTGlzdCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGl0ZW1zID0gdGhpcy5wcm9wcy5kYXRhLml0ZW1zO1xuICAgICAgaWYgKGl0ZW1zKSB7XG4gICAgICAgIHZhciBsaXN0SXRlbXMgPSBpdGVtcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgIHZhciBmbGFncyA9IGl0ZW0uZmxhZ3MubWFwKGZ1bmN0aW9uKGZsYWcpIHtcbiAgICAgICAgICAgIHJldHVybiA8RmxhZ0l0ZW0gZmxhZz17ZmxhZ30vPjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB2YXIgcGF0Y2hlcyA9IGl0ZW0uYXR0YWNobWVudHMubWFwKGZ1bmN0aW9uKHBhdGNoKSB7XG4gICAgICAgICAgICB2YXIgcGF0Y2hGbGFncyA9IHBhdGNoLmZsYWdzLm1hcChmdW5jdGlvbihmbGFnKSB7XG4gICAgICAgICAgICAgIHJldHVybiA8RmxhZ0l0ZW0gZmxhZz17ZmxhZ30vPjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8UGF0Y2hJdGVtIHBhdGNoPXtwYXRjaH0vPlxuICAgICAgICAgICAgICAgIHtwYXRjaEZsYWdzfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIHJlcXVlc3RzID0gcGF0Y2hlcy5jb25jYXQoZmxhZ3MpO1xuXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxMaXN0SXRlbSBpc05ldz17aXRlbS5uZXd9PlxuICAgICAgICAgICAgICA8QnVnSXRlbSBidWc9e2l0ZW0uYnVnfS8+XG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAge3JlcXVlc3RzfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvTGlzdEl0ZW0+XG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8TGlzdCBpdGVtcz17aXRlbXN9PlxuICAgICAgICAgIHtsaXN0SXRlbXN9XG4gICAgICAgIDwvTGlzdD5cbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgUmVzcG9uZExpc3QgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpdGVtcyA9IHRoaXMucHJvcHMuZGF0YS5pdGVtcztcbiAgICAgIGlmIChpdGVtcykge1xuICAgICAgICB2YXIgbGlzdEl0ZW1zID0gaXRlbXMubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICB2YXIgZmxhZ3MgPSBpdGVtLmJ1Zy5mbGFncy5tYXAoZnVuY3Rpb24oZmxhZykge1xuICAgICAgICAgICAgcmV0dXJuIDxGbGFnSXRlbSBmbGFnPXtmbGFnfS8+O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8TGlzdEl0ZW0gaXNOZXc9e2l0ZW0ubmV3fT5cbiAgICAgICAgICAgICAgPEJ1Z0l0ZW0gYnVnPXtpdGVtLmJ1Z30vPlxuICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgIHtmbGFnc31cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L0xpc3RJdGVtPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPExpc3QgaXRlbXM9e2l0ZW1zfT5cbiAgICAgICAgICB7bGlzdEl0ZW1zfVxuICAgICAgICA8L0xpc3Q+XG4gICAgICApO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIFBhdGNoTGlzdCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGl0ZW1zID0gdGhpcy5wcm9wcy5kYXRhLml0ZW1zO1xuICAgICAgaWYgKGl0ZW1zKSB7XG4gICAgICAgIHZhciBsaXN0SXRlbXMgPSBpdGVtcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgIHZhciBwYXRjaGVzID0gaXRlbS5hdHRhY2htZW50cy5tYXAoZnVuY3Rpb24ocGF0Y2gpIHtcbiAgICAgICAgICAgICByZXR1cm4gPFBhdGNoSXRlbSBwYXRjaD17cGF0Y2h9Lz47XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxMaXN0SXRlbSBpc05ldz17aXRlbS5uZXd9PlxuICAgICAgICAgICAgICA8QnVnSXRlbSBidWc9e2l0ZW0uYnVnfS8+XG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAge3BhdGNoZXN9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9MaXN0SXRlbT5cbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxMaXN0IGl0ZW1zPXtpdGVtc30+XG4gICAgICAgICAge2xpc3RJdGVtc31cbiAgICAgICAgPC9MaXN0PlxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBMaXN0ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMucHJvcHMuaXRlbXMpIHtcbiAgICAgICAgcmV0dXJuIDxXYWl0aW5nTGlzdC8+O1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMucHJvcHMuaXRlbXMubGVuZ3RoID09IDApIHtcbiAgICAgICAgcmV0dXJuIDxFbXB0eUxpc3QvPjtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXY+XG4gICAgICAgICAge3RoaXMucHJvcHMuY2hpbGRyZW59XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gIH0pXG5cbiAgdmFyIFdhaXRpbmdMaXN0ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxpc3QtaXRlbVwiPlxuICAgICAgICAgIDxpbWcgc3JjPSdsaWIvaW5kaWNhdG9yLmdpZicgY2xhc3NOYW1lPSdzcGlubmVyJz48L2ltZz5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgfSlcblxuICB2YXIgRW1wdHlMaXN0ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxpc3QtaXRlbSBlbXB0eS1tZXNzYWdlXCI+XG4gICAgICAgICAgTm8gaXRlbXMgdG8gZGlzcGxheVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9KVxuXG4gIHZhciBQYXRjaEl0ZW0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwYXRjaCA9IHRoaXMucHJvcHMucGF0Y2g7XG4gICAgICB2YXIgc2l6ZSA9IE1hdGgucm91bmQocGF0Y2guc2l6ZSAvIDEwMDApICsgXCJLQlwiO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8YSBjbGFzc05hbWU9XCJhdHQtbGlua1wiIGhyZWY9e2F0dGFjaFVSTCArIHBhdGNoLmlkfSB0YXJnZXQ9XCJfYmxhbmtcIlxuICAgICAgICAgICAgIHRpdGxlPXtwYXRjaC5kZXNjcmlwdGlvbiArIFwiIC0gXCIgKyBzaXplfT5cbiAgICAgICAgICAgICBwYXRjaCBieSB7cGF0Y2guYXR0YWNoZXIubmFtZX1cbiAgICAgICAgICA8L2E+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiYXR0LXN1ZmZpeFwiPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiYXR0LWRhdGUgdGltZWFnb1wiIHRpdGxlPXtwYXRjaC5sYXN0X2NoYW5nZV90aW1lfT5cbiAgICAgICAgICAgICAge3BhdGNoLmxhc3RfY2hhbmdlX3RpbWV9XG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgRmxhZ0l0ZW0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBmbGFnID0gdGhpcy5wcm9wcy5mbGFnO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGFnXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZmxhZy1uYW1lXCI+XG4gICAgICAgICAgICB7ZmxhZy5uYW1lfVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJmbGFnLXN0YXR1c1wiPlxuICAgICAgICAgICAge2ZsYWcuc3RhdHVzfSAmbmJzcDtcbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZmxhZy1yZXF1ZXN0ZWVcIj5cbiAgICAgICAgICAgIHtmbGFnLnJlcXVlc3RlZX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBCdWdJdGVtID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYnVnID0gdGhpcy5wcm9wcy5idWc7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImJ1Z1wiPlxuICAgICAgICAgIDxhIGNsYXNzTmFtZT1cImJ1Zy1saW5rXCIgaHJlZj17YnVnVVJMICsgYnVnLmlkfVxuICAgICAgICAgICAgIHRhcmdldD1cIl9ibGFua1wiIHRpdGxlPXtidWcuc3RhdHVzICsgXCIgLSBcIiArIGJ1Zy5zdW1tYXJ5fT5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImJ1Zy1pZFwiPlxuICAgICAgICAgICAgICB7YnVnLmlkfVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgLSZuYnNwO1xuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZnVsbC1idWcgYnVnLXN1bW1hcnlcIj5cbiAgICAgICAgICAgICAge2J1Zy5zdW1tYXJ5fVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJpdGVtLWRhdGUgdGltZWFnb1wiXG4gICAgICAgICAgICAgICAgdGl0bGU9e2J1Zy5sYXN0X2NoYW5nZV90aW1lfT5cbiAgICAgICAgICAgIHtidWcubGFzdF9jaGFuZ2VfdGltZX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBMaXN0SXRlbSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e1wibGlzdC1pdGVtIFwiICsgKHRoaXMucHJvcHMuaXNOZXcgPyBcIm5ldy1pdGVtXCIgOiBcIlwiKX0+XG4gICAgICAgICAge3RoaXMucHJvcHMuY2hpbGRyZW59XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBUb2RvVGFicztcbn0pKCk7XG4iXX0=